<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health & Wellness Habit Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .client-name {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 20px;
            margin-top: 15px;
            display: inline-block;
            font-size: 18px;
        }

        .content {
            padding: 30px;
        }

        .date-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .date-nav button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .date-nav button:hover {
            background: #5568d3;
        }

        .date-nav button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .current-date {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            min-width: 200px;
            text-align: center;
        }

        .habits-list {
            margin-bottom: 30px;
        }

        .habit-item {
            display: flex;
            align-items: center;
            padding: 18px;
            margin-bottom: 12px;
            background: #f8f9fa;
            border-radius: 12px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .habit-item:hover {
            background: #e9ecef;
        }

        .habit-item.completed {
            background: #d4edda;
            border-color: #28a745;
        }

        .habit-checkbox {
            width: 28px;
            height: 28px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #28a745;
        }

        .habit-name {
            flex: 1;
            font-size: 18px;
            color: #333;
        }

        .habit-item.completed .habit-name {
            color: #155724;
            font-weight: 500;
        }

        .delete-habit {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .delete-habit:hover {
            background: #c82333;
        }

        .add-habit-section {
            margin-top: 30px;
            padding: 20px;
            background: #e7f3ff;
            border-radius: 12px;
        }

        .add-habit-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .add-habit-form {
            display: flex;
            gap: 10px;
        }

        .add-habit-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
        }

        .add-habit-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .add-habit-button:hover {
            background: #5568d3;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 12px;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background: #28a745;
            color: white;
            border-radius: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }

        .sync-status.show {
            opacity: 1;
        }

        .sync-status.error {
            background: #dc3545;
        }

        .setup-required {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .setup-required h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .setup-required p {
            color: #856404;
            line-height: 1.6;
        }

        .setup-required code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        @media (max-width: 600px) {
            .container {
                border-radius: 0;
            }

            .content {
                padding: 20px;
            }

            .add-habit-form {
                flex-direction: column;
            }

            .date-nav {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü Health & Wellness Tracker</h1>
            <p>Build better habits, one day at a time</p>
            <div class="client-name" id="clientNameDisplay"></div>
        </div>

        <div class="content">
            <div id="setupMessage"></div>

            <div class="date-nav">
                <button onclick="changeDate(-1)">‚Üê Previous Day</button>
                <div class="current-date" id="currentDate"></div>
                <button onclick="changeDate(1)" id="nextDayBtn">Next Day ‚Üí</button>
            </div>

            <div class="habits-list" id="habitsList"></div>

            <div class="stats" id="stats"></div>

            <div class="add-habit-section">
                <h3>Add New Habit</h3>
                <div class="add-habit-form">
                    <input 
                        type="text" 
                        id="newHabitInput" 
                        class="add-habit-input" 
                        placeholder="e.g., Drink 8 glasses of water"
                        maxlength="100"
                    >
                    <button class="add-habit-button" onclick="addHabit()">Add Habit</button>
                </div>
            </div>
        </div>
    </div>

    <div class="sync-status" id="syncStatus"></div>

    <script>
        // ===== CONFIGURATION =====
        // Replace this URL with your Google Apps Script Web App URL after deployment
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbypAwijEMpSHw8FO2A66oes0k8C6gietHCAJeMJ0cjlC3xPPx3viNhLd5KXulxjQJqU/exec';
        
        // ===== APP STATE =====
        let currentDate = new Date();
        currentDate.setHours(0, 0, 0, 0);
        let clientId = '';
        let clientName = '';

        // Initialize app
        function init() {
            // Get client ID from URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            clientId = urlParams.get('client') || '';
            
            if (!clientId) {
                showSetupMessage();
                return;
            }

            // Extract client name from ID (convert john-smith to John Smith)
            clientName = clientId.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');

            document.getElementById('clientNameDisplay').textContent = clientName;
            
            updateDateDisplay();
            loadDataFromServer();
        }

        function showSetupMessage() {
            document.getElementById('setupMessage').innerHTML = `
                <div class="setup-required">
                    <h3>‚ö†Ô∏è Setup Required</h3>
                    <p>This tracker needs to be accessed with a unique client link.</p>
                    <p>Your wellness coach will provide you with a personalized link like:</p>
                    <p><code>habit-tracker.html?client=your-name</code></p>
                </div>
            `;
        }

        // ===== DATA MANAGEMENT =====
        function getStorageKey(suffix) {
            return `client_${clientId}_${suffix}`;
        }

        function getHabits() {
            const habits = localStorage.getItem(getStorageKey('habits'));
            return habits ? JSON.parse(habits) : [];
        }

        function saveHabits(habits) {
            localStorage.setItem(getStorageKey('habits'), JSON.stringify(habits));
        }

        function getCompletions() {
            const completions = localStorage.getItem(getStorageKey('completions'));
            return completions ? JSON.parse(completions) : {};
        }

        function saveCompletions(completions) {
            localStorage.setItem(getStorageKey('completions'), JSON.stringify(completions));
        }

        // ===== SERVER SYNC =====
        async function syncToServer(action, data) {
            if (SCRIPT_URL === 'YOUR_GOOGLE_SCRIPT_URL_HERE') {
                console.log('Google Script URL not configured');
                return;
            }

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: action,
                        clientId: clientId,
                        clientName: clientName,
                        data: data
                    })
                });

                showSyncStatus('Synced to coach', false);
            } catch (error) {
                console.error('Sync error:', error);
                showSyncStatus('Sync failed - data saved locally', true);
            }
        }

        async function loadDataFromServer() {
            // For now, we'll use local storage
            // If server sync is configured, this would fetch initial data
            renderHabits();
            renderStats();
        }

        function showSyncStatus(message, isError = false) {
            const status = document.getElementById('syncStatus');
            status.textContent = message;
            status.className = 'sync-status show' + (isError ? ' error' : '');
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // ===== DATE FUNCTIONS =====
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDateDisplay(date) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            if (date.getTime() === today.getTime()) {
                return 'Today - ' + date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
            } else if (date.getTime() === yesterday.getTime()) {
                return 'Yesterday - ' + date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
            } else if (date.getTime() === tomorrow.getTime()) {
                return 'Tomorrow - ' + date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
            } else {
                return date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
            }
        }

        function updateDateDisplay() {
            document.getElementById('currentDate').textContent = formatDateDisplay(currentDate);
            
            // Disable next day button if viewing future
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const nextBtn = document.getElementById('nextDayBtn');
            nextBtn.disabled = currentDate >= today;
        }

        function changeDate(days) {
            currentDate.setDate(currentDate.getDate() + days);
            updateDateDisplay();
            renderHabits();
            renderStats();
        }

        // ===== HABIT MANAGEMENT =====
        function addHabit() {
            const input = document.getElementById('newHabitInput');
            const habitName = input.value.trim();
            
            if (habitName === '') {
                alert('Please enter a habit name');
                return;
            }

            const habits = getHabits();
            
            if (habits.length >= 10) {
                alert('Maximum 10 habits allowed. Please delete a habit before adding a new one.');
                return;
            }

            const newHabit = {
                id: Date.now(),
                name: habitName,
                createdAt: new Date().toISOString()
            };

            habits.push(newHabit);
            saveHabits(habits);
            
            // Sync to server
            syncToServer('addHabit', { habit: newHabit });
            
            input.value = '';
            renderHabits();
            renderStats();
        }

        function deleteHabit(habitId) {
            if (!confirm('Are you sure you want to delete this habit? All tracking data for this habit will be lost.')) {
                return;
            }

            let habits = getHabits();
            habits = habits.filter(h => h.id !== habitId);
            saveHabits(habits);

            const completions = getCompletions();
            Object.keys(completions).forEach(dateKey => {
                delete completions[dateKey][habitId];
            });
            saveCompletions(completions);

            // Sync to server
            syncToServer('deleteHabit', { habitId: habitId });

            renderHabits();
            renderStats();
        }

        function toggleHabit(habitId) {
            const dateKey = formatDate(currentDate);
            const completions = getCompletions();
            
            if (!completions[dateKey]) {
                completions[dateKey] = {};
            }

            const isCompleted = !completions[dateKey][habitId];
            completions[dateKey][habitId] = isCompleted;
            saveCompletions(completions);
            
            // Sync to server
            const habits = getHabits();
            const habit = habits.find(h => h.id === habitId);
            
            syncToServer('toggleHabit', {
                date: dateKey,
                habitId: habitId,
                habitName: habit ? habit.name : 'Unknown',
                completed: isCompleted,
                allHabits: habits,
                dayCompletions: completions[dateKey]
            });
            
            renderHabits();
            renderStats();
        }

        // ===== RENDERING =====
        function renderHabits() {
            const habits = getHabits();
            const habitsList = document.getElementById('habitsList');
            const dateKey = formatDate(currentDate);
            const completions = getCompletions();
            const todayCompletions = completions[dateKey] || {};

            if (!clientId) {
                return;
            }

            if (habits.length === 0) {
                habitsList.innerHTML = `
                    <div class="empty-state">
                        <h3>No habits yet!</h3>
                        <p>Add your first health & wellness habit below to get started.</p>
                    </div>
                `;
                return;
            }

            habitsList.innerHTML = habits.map(habit => {
                const isCompleted = todayCompletions[habit.id] || false;
                return `
                    <div class="habit-item ${isCompleted ? 'completed' : ''}">
                        <input 
                            type="checkbox" 
                            class="habit-checkbox"
                            ${isCompleted ? 'checked' : ''}
                            onchange="toggleHabit(${habit.id})"
                        >
                        <span class="habit-name">${habit.name}</span>
                        <button class="delete-habit" onclick="deleteHabit(${habit.id})">Delete</button>
                    </div>
                `;
            }).join('');
        }

        function renderStats() {
            const habits = getHabits();
            const completions = getCompletions();
            const dateKey = formatDate(currentDate);
            const todayCompletions = completions[dateKey] || {};

            const completedToday = Object.values(todayCompletions).filter(v => v).length;
            const totalHabits = habits.length;
            const completionRate = totalHabits > 0 ? Math.round((completedToday / totalHabits) * 100) : 0;

            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (totalHabits > 0) {
                let checkDate = new Date(today);
                checkDate.setDate(checkDate.getDate() - 1);
                
                while (true) {
                    const checkKey = formatDate(checkDate);
                    const dayCompletions = completions[checkKey] || {};
                    const completedCount = habits.filter(h => dayCompletions[h.id]).length;
                    
                    if (completedCount === totalHabits) {
                        streak++;
                        checkDate.setDate(checkDate.getDate() - 1);
                    } else {
                        break;
                    }
                    
                    if (streak > 365) break;
                }
            }

            let totalCompletions = 0;
            for (let i = 0; i < 30; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(checkDate.getDate() - i);
                const checkKey = formatDate(checkDate);
                const dayCompletions = completions[checkKey] || {};
                totalCompletions += Object.values(dayCompletions).filter(v => v).length;
            }

            const statsHtml = `
                <div class="stat-box">
                    <div class="stat-number">${completedToday}/${totalHabits}</div>
                    <div class="stat-label">Today</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${completionRate}%</div>
                    <div class="stat-label">Completion Rate</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${streak}</div>
                    <div class="stat-label">Day Streak</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${totalCompletions}</div>
                    <div class="stat-label">Last 30 Days</div>
                </div>
            `;

            document.getElementById('stats').innerHTML = statsHtml;
        }

        // ===== EVENT LISTENERS =====
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('newHabitInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addHabit();
                }
            });
        });

        // Initialize the app
        init();
    </script>
</body>
</html>
